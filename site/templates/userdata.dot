<div class="card">
	<div class="card-inner">
		<h2>
			{{=it.user.username}}
			<span class="tooltip right" *click="export_data('{{= it.user.username }}')">
				<i class="fa-solid fa-cloud-arrow-down"></i>
				<span class="tooltiptext t-float-left">Export all user data</span>
			</span>
		</h2>
		<div>
			<input id="user-new-password" type="password" placeholder="New Password" autocomplete="new-password"><br>
			<input id="user-new-password2" type="password" placeholder="Confirm Password" autocomplete="new-password">
			<button class="icon" *click="update_password($('user-new-password').value, '{{=it.user.username}}')"><i class="fa-solid fa-right-to-bracket fa-lg"></i></button>
		</div>

		<div>
			<br>
			Display Name:<br>
			<input id="user-display-name" placeholder="{{= it.user.username.substring(0,1).toUpperCase() + it.user.username.substring(1)}}" value="{{= it.user.display_name }}" *bind="update_user_display_name('{{= it.user.username }}')">
			&nbsp;<i id="icon-user-display-name" class="fa-solid fa-circle-check hidden"></i>

			{{? false}} <!-- Email is not used currently. When we intend to use it, remove this conditional. -->
			<br>
			Email:<br>
			<input id="user-email" placeholder="None specified" value="{{= it.user.email || '' }}" *bind="update_user_email('{{= it.user.username }}')">
			&nbsp;<i id="icon-user-email" class="fa-solid fa-circle-check hidden"></i>
			{{?}}
		</div>
		{{? has_perm('admin') }}
		<div class="section">
			<label>Admin Options</label>
			<div>
				<span id="usrgrp" template="user_group_list"></span>
				<button class="icon" *click="update_groups('{{= it.user.username }}')"><i class="fa-solid fa-floppy-disk fa-lg"></i></button>
				<span class="tooltip" *click="show_group_tooltip">
					<i class="fa-solid fa-circle-question"></i>
					<span class="tooltiptext t-left">What is this?</span>
				</span>
				<table>
					{{~it.perms: perm}}
						<tr>
							<td>
								<span class="tooltip">
									{{=perm.name}}
									<span class="tooltiptext t-right t-persist" id="perm-tooltip-{{=perm.name}}">Placeholder Text. You should never see this!</span>
								</span>
							</td>
							<td>
								<input id="perm-{{=perm.name}}" type="checkbox" {{?it.user.perms.includes(perm.name)}}checked{{?}} *click="set_perms()" {{?((perm.name==='admin') && (api.username === it.user.username)) || it.self_view}}disabled{{?}}>
							</td>
							<td>
								<i id="icon-perm-{{=perm.name}}" class="fa-solid fa-circle-check hidden"></i>
							</td>
						</tr>
					{{~}}
				</table>
			</div>
		</div>
		{{?}}

		{{? it.self_view }}
		<div name="user-feature-list">
			<h3 class="clickable" *toggles="user-modules" >
				Enabled Features
				<i class="right fa-solid fa-angles-down"></i>
			</h3>
			<div class="expand-container" id="user-modules">
				<div>
					<table>
						<tr>
							<td colspan="4" style="max-width:inherit;">
								If you don't want certain features,<br>
								you can disable them here.<br>
								Don't worry, you can always enable<br>
								them later if you change your mind.
							</td>
						</tr>
						<tr>
							<td>
								<span class="tooltip" *click="show_notifications_info" >
									<i class="fa-solid fa-circle-question"></i>
									<span class="tooltiptext t-right">What is this?</span>
								</span>
							</td>
							<td>
								<span class="tooltip">
									<span>Notifications</span>
									<span class="tooltiptext t-right t-persist">Receive push notifications on this device.</span>
								</span>
							</td>
							<td>
								<input type="checkbox" id="enable-push" *click="enable_push_notifs" {{? push.subscribed }} checked {{?}}>
							</td>
							<td>
								<i id="icon-notif" class="fa-solid fa-circle-check hidden"></i>
							</td>
						</tr>

						{{~ it.all_modules : mod }}
						<tr>
							<td></td>
							<td>
								<span class="tooltip">
									<span id="module-name-{{= mod }}">{{= mod }}</span>
									<span class="tooltiptext t-right t-persist" id="module-tooltip-{{= mod }}">Placeholder Text. You should never see this!</span>
								</span>
							</td>
							<td>
								<input id="module-{{= mod }}" type="checkbox" *click="update_user_module" {{? !it.user.disabled_modules.includes(mod)}} checked {{?}}>
							</td>
							<td>
								<i id="icon-module-{{= mod }}" class="fa-solid fa-circle-check hidden"></i>
							</td>
						<tr>
						{{~}}
					</table>
				</div>
			</div>
			{{?}}
		</div>

		<br>
		<i class="left">Active Sessions: <span id="session-ct-{{=it.user.username}}">{{=it.sessions}}</span></i>
		<button class="right" *click="revoke_sessions('{{=it.user.username}}')" >Revoke?</button>
		<span class="tooltip" *click="show_sessions_info" >
			<i class="fa-solid fa-circle-question"></i>
			<span class="tooltiptext t-center">What does this mean?</span>
		</span>
		<br>
		<i>Last Login:</i> {{?it.user.last_login}}{{=date.output(it.user.last_login)}}<br><span class="disabled">{{=date.elapsed(it.user.last_login)}}</span>{{??}}Never{{?}}

		{{? !it.self_view && it.user.username !== api.username }}
			<button class="big wide border" *click="confirm_delete_user('{{=it.user.username}}')">Delete</button>
		{{?}}
	</div>
</div>
